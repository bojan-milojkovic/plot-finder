<!DOCTYPE html>
<html>
  <head>
	<title>Reading from database into Google Maps</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
		position: absolute;
		top: 3px;
		left: 4px;
        height: 95%;
		width: 50%;
		align: left;
      }
	  #infowindow {
        height: 90%;
		width: 50%;
		position: absolute;
		right: -6px;
		top: 0px;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
	  body, #descRow {
		position: relative;
	  }
	  th, td {
		text-align: left;
	  }
	  #descCell {
		position: absolute;
		left:20px;
	  }
    </style>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  </head>
  <body>
    <div id="map"></div>
	<div id="infowindow">
		<table id="basicinfo">
			<tr><th>Title :</th><td id="titleCell"></td></tr>
			<tr ><th>Description :</th></tr><tr id="descRow"><td id="descCell"></td><td><br/></td></tr>
			<tr><th>Address line 1 :</th><td id="add1Cell"></td></tr>
			<tr><th>Address line 2 :</th><td id="add2Cell"></td></tr>
			<tr><th>District :</th><td id="distCell"></td></tr>
			<tr><th>City :</th><td id="cityCell"></td></tr>
			<tr><th>Country :</th><td id="countryCell"></td></tr>
			<tr><th>Plot size : </th><td id="sizeCell"></td><th>Plot is for </th><td id="typeCell"></td></tr>
			<tr><th>Price :</th><td id="priceCell"></td><th>Currency :</th><td id="curCell"></td></tr>
		</table><br/>
		<table id="aditionalInfo" class="unchanging">
			<tr><th><input type="checkbox" id="house"> Plot has a house</th><th><input type="checkbox" id="garage"> Plot has a garage</th></tr>
			<tr><th><input type="checkbox" id="power"> Plot has power</th><th><input type="checkbox" id="internet"> Plot has internet</th></tr>
			<tr><th><input type="checkbox" id="sewer"> Plot has a sewer</th></tr>
			<tr><th><input type="checkbox" id="water"> Plot has a water</th></tr>
			<tr><th><input type="checkbox" id="gas"> Plot has gas station/gas line near by</th></tr>
			<tr><th><input type="checkbox" id="farming"> Plot is for farming</th></tr>
			<tr><th><input type="checkbox" id="grazing"> Plot is for grazing</th></tr>
			<tr><th><input type="checkbox" id="orchard"> Plot is an orchard</th></tr>
		</table>
	</div>
    <script>
	
		var json;
		var map;
		
		var customLabel = {
			RENT: {
			  label: 'R'
			},
			SALE: {
			  label: 'S'
			}
		};
		
		function getPlots(){
			var plots = '{\"plots":[{';
			// plot1:
			plots+='\"title\":\"First plot title\",';
			plots+='\"description\":\"First plot description\",';
			plots+='\"address1\":\"First plot address 1\",';
			plots+='\"address2\":\"First plot address 2\",';
			plots+='\"district\":\"First plot district\",';
			plots+='\"city\":\"First plot city\",';
			plots+='\"country\":\"First plot country\",';
			plots+='\"type\":\"RENT\",';
			plots+='\"size\":\"24\",';
			plots+='\"price\":\"265\",';
			plots+='\"currency\":\"USD\",';
			plots+='\"house\":\"true\",';
			plots+='\"power\":\"true\",';
			plots+='\"water\":\"true\",';
			plots+='\"sewer\":\"true\",';
			plots+='\"vertices\":[';
			plots+='{\"lat\": -33.863276, \"lng\": 151.207977},';
			plots+='{\"lat\": -33.863276, \"lng\": 151.208977},';
			plots+='{\"lat\": -33.864276, \"lng\": 151.208977},';
			plots+='{\"lat\": -33.864276, \"lng\": 151.207977}';
			plots+=']},{';
			// plot2:
			plots+='\"title\":\"Second plot title\",';
			plots+='\"description\":\"Second plot description\",';
			plots+='\"address1\":\"Second plot address 1\",';
			plots+='\"address2\":\"Second plot address 2\",';
			plots+='\"district\":\"Second plot district\",';
			plots+='\"city\":\"Second plot city\",';
			plots+='\"country\":\"Second plot country\",';
			plots+='\"type\":\"SALE\",';
			plots+='\"size\":\"54\",';
			plots+='\"price\":\"265481\",';
			plots+='\"currency\":\"EUR\",';
			plots+='\"orchard\":\"true\",';
			plots+='\"vertices\":[';
			plots+='{\"lat\": -33.865276, \"lng\": 151.206977},';
			plots+='{\"lat\": -33.865276, \"lng\": 151.207977},';
			plots+='{\"lat\": -33.866276, \"lng\": 151.207977},';
			plots+='{\"lat\": -33.866276, \"lng\": 151.206977}';
			plots += ']}]}';
			return plots;
		}
	  
		function initMap(){
			map = new google.maps.Map(document.getElementById('map'), {
				center: new google.maps.LatLng(-33.863276, 151.207977),
				zoom: 15
			});
		
			json = JSON.parse(getPlots());
			
			createPolygons(json.plots);
			
			fillPlotInfo(json.plots[0]);
		}
		
		function createPolygons(plots){
		
			var polygons = [];
			
			plots.forEach(function(plot, index) {
				var polygon = new google.maps.Polygon({
						pIndex: index,
						plotId: plot.id,
						paths: plot.vertices,
						strokeColor: '#FF0000',
						strokeOpacity: 0.8,
						strokeWeight: 2,
						fillColor: '#FF0000',
						fillOpacity: 0.35,
						editable: false
					});
				polygon.setMap(map);
				
				polygon.addListener('click', function(clickedPolygon){
					fillPlotInfo(plots[index]);
				});
				
				polygons.push(polygon);
			});
		}
		
		function fillPlotInfo(plot){
			$('#titleCell').text(plot.title);
			$('#descCell').text(plot.description);
			$('#add1Cell').text(plot.address1);
			$('#add2Cell').text(plot.address2);
			$('#distCell').text(plot.district);
			$('#cityCell').text(plot.city);
			$('#countryCell').text(plot.country);
			$('#curCell').text(plot.currency);
			$('#priceCell').text(plot.price);
			$('#sizeCell').text(plot.size);
			$('#typeCell').text(plot.type);
				
			$('#house').prop('checked',plot.house);
			$('#power').prop('checked',plot.power);
			$('#water').prop('checked',plot.water);
			$('#sewer').prop('checked',plot.sewer);
			
			$('#gas').prop('checked',plot.gas);
			$('#internet').prop('checked',plot.internet);
			$('#garage').prop('checked',plot.garage);
			
			$('#farming').prop('checked',plot.farming);
			$('#orchard').prop('checked',plot.orchard);
			$('#grazing').prop('checked',plot.grazing);
		}
    </script>
    <script async defer 
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAnUcOUuCwexpeI5wIAZMkpK5LRYDAajgk&callback=initMap">
	</script>
  </body>
</html>